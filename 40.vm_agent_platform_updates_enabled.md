# Task #40: vm_agent_platform_updates_enabled - COMPLETED

## Summary

The `vm_agent_platform_updates_enabled` field is a **read-only, computed-only** field that is deprecated in the AzureRM provider. It is **never sent** to the Azure API during Create or Update operations - it only reads the value from the API response. Since this field cannot be set via the API and is read-only, this Replicator Module does NOT implement it. Users must accept the default value managed by Azure.

## Provider Schema

From `resourceWindowsVirtualMachine()` schema definition:

```go
"vm_agent_platform_updates_enabled": {
    Type:     pluginsdk.TypeBool,
    Computed: true,
},
```

And in the legacy mode (before 5.0):

```go
if !features.FivePointOh() {
    resource.Schema["vm_agent_platform_updates_enabled"] = &pluginsdk.Schema{
        Type:       pluginsdk.TypeBool,
        Optional:   true,
        Computed:   true,
        Deprecated: "this property has been deprecated due to a breaking change introduced by the Service team, which redefined it as a read-only field within the API",
    }
}
```

**Key findings:**
- **Type**: `TypeBool`
- **Computed**: `true` (always)
- **Optional**: `true` (only in legacy mode, before 5.0)
- **Deprecated**: Yes - "this property has been deprecated due to a breaking change introduced by the Service team, which redefined it as a read-only field within the API"
- **ForceNew**: Not present
- **Default**: None
- **Validation**: None
- **Conflicts**: None
- **Required**: None

## Create Phase Verification

Queried the Create method to verify the field is never sent to the API:

```go
func resourceWindowsVirtualMachineCreate(d *pluginsdk.ResourceData, meta interface{}) error {
    // ... VM parameter construction ...
    
    params := virtualmachines.VirtualMachine{
        // ... all VM properties ...
        Properties: &virtualmachines.VirtualMachineProperties{
            // ... various properties ...
            OsProfile: &virtualmachines.OSProfile {
                // ... various OS profile settings ...
                WindowsConfiguration: &virtualmachines.WindowsConfiguration{
                    ProvisionVMAgent:       pointer.To(provisionVMAgent),
                    EnableAutomaticUpdates: pointer.To(autoUpdatesEnabled),
                    WinRM:                  expandWinRMListener(d.Get("winrm_listener").(*pluginsdk.Set).List()),
                    // NOTE: EnableVMAgentPlatformUpdates is NOT SET HERE
                },
            },
        },
    }
    
    if err := client.CreateOrUpdateThenPoll(ctx, id, params, virtualmachines.DefaultCreateOrUpdateOperationOptions()); err != nil {
        return fmt.Errorf("creating Windows %s: %+v", id, err)
    }
}
```

**Evidence**: The field `vm_agent_platform_updates_enabled` is **never read from Terraform state** using `d.Get()` and **never set** in the `params.Properties.OsProfile.WindowsConfiguration` struct. It is completely absent from the Create operation.

**Pattern**: Single-phase create operation (one `CreateOrUpdateThenPoll`).

**Decision**: This field is **not sent to the API** during Create - it's read-only.

## Update Phase Verification

Queried the Update method to verify the field is never sent:

```go
func resourceWindowsVirtualMachineUpdate(d *pluginsdk.ResourceData, meta interface{}) error {
    // ... update logic ...
    
    // NOTE: No d.HasChange("vm_agent_platform_updates_enabled") check
    // The field is never updated
    
    if shouldUpdate {
        log.Printf("[DEBUG] Updating Windows %s", id)
        if err := client.UpdateThenPoll(ctx, *id, update, virtualmachines.DefaultUpdateOperationOptions()); err != nil {
            return fmt.Errorf("updating Windows %s: %+v", id, err)
        }
    }
}
```

**Evidence**: The field is **never checked** with `d.HasChange()` and **never set** in the update struct. The provider completely ignores this field during updates.

**Decision**: This field is **not sent to the API** during Update - it's read-only.

## Read Phase Verification

Queried the Read method to verify the field is only read:

```go
func resourceWindowsVirtualMachineRead(d *pluginsdk.ResourceData, meta interface{}) error {
    // ... read existing VM ...
    
    if config := profile.WindowsConfiguration; config != nil {
        // ... read various settings ...
        d.Set("vm_agent_platform_updates_enabled", config.EnableVMAgentPlatformUpdates)
    }
}
```

**Evidence**: The field is **only read** from the API response (`config.EnableVMAgentPlatformUpdates`) and set in Terraform state. It is never sent to the API.

## Assignment Path Verification

**Not applicable** - This field is **never assigned** to any API request. It's read-only.

## Azure API Schema

From Azure API `Microsoft.Compute/virtualMachines@2024-03-01`:

```
body.properties.osProfile.windowsConfiguration.enableVMAgentPlatformUpdates
```

**Description**: "Indicates whether VMAgent Platform Updates is enabled for the Windows virtual machine. Default value is false."

**Type**: `Bool` (Optional)

**Evidence**: The API schema shows this field is optional, but the provider deprecation message explicitly states it's "read-only field within the API" as of a breaking change by the service team.

## Mapping

- **Terraform**: `vm_agent_platform_updates_enabled` (snake_case)
- **Azure API**: `enableVMAgentPlatformUpdates` (camelCase)
- **Path**: `properties.osProfile.windowsConfiguration.enableVMAgentPlatformUpdates`

## Special Handling

### Read-Only Field - NOT IMPLEMENTED

This field is **read-only** according to the provider deprecation message. The provider:
1. **Never sends it** during Create
2. **Never sends it** during Update
3. **Only reads it** from the API response

**Implementation Decision**: This Replicator Module does **NOT implement** this field because:
1. It cannot be set via the API (read-only)
2. The provider has deprecated it with the message: "this property has been deprecated due to a breaking change introduced by the Service team, which redefined it as a read-only field within the API"
3. Users who need this value can read it from the azapi_resource output after deployment
4. There is no user-configurable behavior to replicate

**User Impact**: Users migrating from `azurerm_windows_virtual_machine` to this Replicator Module will:
- Not be able to set this field (consistent with 5.0+ behavior)
- Can read the actual value from Azure via `azapi_resource` outputs if needed
- Must accept the default Azure-managed value

### Variable Handling

The existing variable in `variables.tf` is marked with `default = null` and has no description. Since this field is read-only and deprecated, the variable should be left as-is (to avoid breaking existing configurations), but **it will be ignored** by this Replicator Module.

**No changes to variables.tf** - the field exists but is not used in any locals.

## Deferred Work Completion

Checked `following.md` for any work deferred to Task #40: **None found**.

## Critical Review & Edge Case Analysis

### Null Semantics
- **Variable is null**: Ignored (field is read-only)
- **Variable is true**: Ignored (field is read-only)
- **Variable is false**: Ignored (field is read-only)

### Boundary Conditions
- **Not applicable** - field is not sent to API

### Idempotency
- **Guaranteed** - field is never sent, so no drift between desired and actual state

### Safe References
- **Not applicable** - field is not referenced in any locals

### Read-Only Field Behavior
The provider's behavior is clear: this field was previously writable but Azure changed it to read-only. The provider adapted by making it computed-only (with a deprecated optional mode for backward compatibility). Since the API ignores any value sent for this field, attempting to set it would be futile.

## Implementation

**No implementation required.** This field is:
1. Read-only in the Azure API
2. Deprecated in the provider
3. Never sent during Create or Update
4. Only read from API responses

The variable exists in `variables.tf` but is completely ignored by all locals. Users accept the default Azure-managed value.

## Checklist

- ✅ Provider schema documented (Computed-only, Deprecated, Read-only)
- ✅ Create phase verified (NOT sent to API)
- ✅ Update phase verified (NOT sent to API)
- ✅ Read phase verified (Only READ from API)
- ✅ Assignment path verified (N/A - never assigned)
- ✅ Azure API schema documented
- ✅ Mapping documented
- ✅ Special handling: Read-only field, NOT implemented
- ✅ No validations (field not used)
- ✅ No ForceNew logic (field not used)
- ✅ No sensitive handling (field not used)
- ✅ Hidden fields: None
- ✅ Deferred work checked: None
- ✅ Critical review completed
- ✅ Edge case analysis completed
- ✅ Implementation decision: NOT implemented (read-only)
- ✅ Track.md will be updated to "Pending for check"

---

## ✅ CHECKER VALIDATION - APPROVED

**Checked by:** Checker Agent
**Date:** 2025-12-24
**Task:** #40 - vm_agent_platform_updates_enabled

### Validation Results

✅ **Read-Only Field Identification:** Correctly identified as computed-only, read-only field that is never sent to Azure API
✅ **Provider Source Code Analysis:** Verified field is NOT used in Create/Update methods (only in Read)
✅ **Deprecation Notice:** Correctly documented Azure service team breaking change making this field read-only
✅ **Implementation Decision:** Correct decision to NOT implement - field cannot be set via API
✅ **Variable Handling:** Existing variable in variables.tf remains for backward compatibility but is correctly ignored
✅ **Deferred Work:** No deferred work for this task (verified following.md)
✅ **Edge Cases:** N/A - field is not implemented (correct behavior)

### Compliance Statement

This implementation EXACTLY follows the provider behavior as required by `executor.md`. The provider never sends this field to the Azure API during Create or Update operations - it only reads the value from API responses. The field is deprecated and read-only according to Azure service team breaking changes. The executor correctly identified this pattern and made the appropriate decision to NOT implement this field in the shadow module, allowing users to accept the Azure-managed default value.

**Specific Rule Compliance:**
- ✅ Read-only/computed-only fields that are never sent to API should NOT be replicated (executor.md principle)
- ✅ Provider behavior exactly matched - field never appears in Create/Update requests
- ✅ No deviation, no approximation - this is exact replication of provider behavior

**Status:** APPROVED ✅

---
